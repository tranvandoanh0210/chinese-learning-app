<div class="import-export-panel">
  <div class="panel-header">
    <h3>üìä Qu·∫£n l√Ω d·ªØ li·ªáu</h3>
  </div>
  <div class="action-buttons">
    <div>
      <button class="btn btn-primary" (click)="exportData()">üì• Export all to Excel</button>
      <small>Xu·∫•t t·∫•t c·∫£ b√†i h·ªçc ra file Excel</small>
    </div>
    <div class="import-section">
      <input
        type="file"
        #importReplace
        (change)="onFileSelected($event, 'replace')"
        accept=".xlsx, .xls"
        style="display: none"
      />
      <button class="btn btn-warning" (click)="importReplace.click()">üì§ Import replace</button>
      <small>Thay th·∫ø to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i b·∫±ng file Excel m·ªõi</small>
    </div>
    <div class="import-section">
      <input
        type="file"
        #importAdd
        (change)="onFileSelected($event, 'add')"
        accept=".xlsx, .xls"
        style="display: none"
      />
      <button class="btn btn-warning" (click)="importAdd.click()">üì§ Import add</button>
      <small>Thay th·∫ø to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i b·∫±ng file Excel m·ªõi</small>
    </div>

    <div>
      <button class="btn btn-success btn-block" (click)="openDeployDialog()">
        üöÄ Deploy GitHub
      </button>

      <small>Deploy d·ªØ li·ªáu l√™n GitHub repository</small>
    </div>
  </div>

  <!-- Import Results -->
  @if(importResult){
  <div class="import-results">
    <h4>K·∫øt qu·∫£ import</h4>
    <div [class]="importResult.success ? 'success' : 'error'">
      {{ importResult.success ? 'Import th√†nh c√¥ng!' : 'Import th·∫•t b·∫°i!' }}
    </div>

    @if(importResult.success){
    <div>
      <p>ƒê√£ import {{ importResult.lessons.length }} b√†i h·ªçc</p>

      <button class="btn btn-success" (click)="openDeployDialog()">üöÄ Deploy GitHub</button>
    </div>
    } @if(importResult.errors.length > 0){
    <div class="errors">
      <h5>L·ªói:</h5>
      <ul>
        @for (error of importResult.errors; track $index) {
        <li>{{ error }}</li>
        }
      </ul>
    </div>
    }
  </div>
  }

  <!-- Deployment Status -->
  @if(deploymentStatus){
  <div class="deployment-status">
    <h4>Tr·∫°ng th√°i deploy</h4>
    <div [class]="deploymentStatus.success ? 'success' : 'error'">
      {{ deploymentStatus.message }}
    </div>
  </div>
  } @if(showTokenDialog){
  <div class="dialog-overlay">
    <div class="dialog-container">
      <div class="dialog-header">
        <h3>üîë Nh·∫≠p GitHub Token</h3>
        <button (click)="closeTokenDialog()" class="btn-close">√ó</button>
      </div>

      <div class="dialog-body">
        <form [formGroup]="tokenForm" (ngSubmit)="saveAndDeploy()">
          <div class="form-group">
            <label for="githubToken">GitHub Personal Access Token:</label>
            <input
              type="password"
              id="githubToken"
              formControlName="githubToken"
              placeholder="Nh·∫≠p token b·∫Øt ƒë·∫ßu b·∫±ng ghp_..."
              class="form-control"
            />
            @if(tokenForm.get('githubToken')?.invalid && tokenForm.get('githubToken')?.touched) {
            <div class="error-text">
              @if(tokenForm.get('githubToken')?.errors?.['required']) {
              <div>Token l√† b·∫Øt bu·ªôc</div>
              } @if(tokenForm.get('githubToken')?.errors?.['minlength']) {
              <div>Token ph·∫£i c√≥ √≠t nh·∫•t 10 k√Ω t·ª±</div>
              }
            </div>
            }
          </div>

          <div class="token-help">
            <h5>üîß C√°ch l·∫•y token:</h5>
            <ol>
              <li>
                Truy c·∫≠p
                <a href="https://github.com/settings/tokens" target="_blank">GitHub Tokens</a>
              </li>
              <li>T·∫°o token m·ªõi v·ªõi quy·ªÅn <code>public_repo</code></li>
              <li>Copy token (b·∫Øt ƒë·∫ßu b·∫±ng <code>ghp_</code>)</li>
              <li>D√°n token v√†o √¥ tr√™n</li>
            </ol>
            <p class="note">‚ö†Ô∏è Token ch·ªâ ƒë∆∞·ª£c s·ª≠ d·ª•ng cho l·∫ßn deploy n√†y v√† kh√¥ng ƒë∆∞·ª£c l∆∞u tr·ªØ</p>
          </div>

          <div class="dialog-actions">
            <button
              type="button"
              (click)="closeTokenDialog()"
              class="btn btn-secondary"
              [disabled]="isSubmittingToken"
            >
              H·ªßy
            </button>
            <button
              type="submit"
              class="btn btn-success"
              [disabled]="tokenForm.invalid || isSubmittingToken"
            >
              {{ isSubmittingToken ? 'üîÑ ƒêang x·ª≠ l√Ω...' : 'üöÄ Deploy' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  }
</div>
