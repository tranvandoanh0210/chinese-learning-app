<div class="import-export-panel">
  <div class="panel-header">
    <h3>ğŸ“Š Quáº£n lÃ½ dá»¯ liá»‡u</h3>
  </div>
  <div class="action-buttons">
    <div>
      <button class="btn btn-primary" (click)="exportData()">ğŸ“¥ Export to Excel</button>
      <small>Xuáº¥t táº¥t cáº£ bÃ i há»c ra file Excel</small>
    </div>
    <div class="import-section">
      <input
        type="file"
        #fileInput
        (change)="onFileSelected($event)"
        accept=".xlsx, .xls"
        style="display: none"
      />
      <button class="btn btn-success" (click)="fileInput.click()">ğŸ“¤ Import from Excel</button>
      <small>Thay tháº¿ toÃ n bá»™ dá»¯ liá»‡u hiá»‡n táº¡i báº±ng file Excel má»›i</small>
    </div>
    <div>
      <button class="btn btn-success btn-block" (click)="updateDataFile()">
        ğŸ’¾ Cáº­p nháº­t data.ts
      </button>

      <small>Táº¡o file data.ts tá»« dá»¯ liá»‡u hiá»‡n táº¡i</small>
    </div>
    <div>
      <button class="btn btn-warning btn-block" (click)="deployToGithub()">ğŸš€ Deploy GitHub</button>

      <small>Deploy dá»¯ liá»‡u lÃªn GitHub repository</small>
    </div>
  </div>

  <!-- Import Results -->
  @if(importResult){
  <div class="import-results">
    <h4>Káº¿t quáº£ import</h4>
    <div [class]="importResult.success ? 'success' : 'error'">
      {{ importResult.success ? 'Import thÃ nh cÃ´ng!' : 'Import tháº¥t báº¡i!' }}
    </div>

    @if(importResult.success){
    <div>
      <p>ÄÃ£ import {{ importResult.lessons.length }} bÃ i há»c</p>
      <div class="action-buttons">
        <button class="btn btn-success" (click)="saveLocally()">ğŸ’¾ LÆ°u local</button>
        <button class="btn btn-success" (click)="openDeployDialog()">ğŸ’¾ LÆ°u vÃ  Deploy</button>
      </div>
    </div>
    } @if(importResult.errors.length > 0){
    <div class="errors">
      <h5>Lá»—i:</h5>
      <ul>
        @for (error of importResult.errors; track $index) {
        <li>{{ error }}</li>
        }
      </ul>
    </div>
    }
  </div>
  }

  <!-- Deployment Status -->
  @if(deploymentStatus){
  <div class="deployment-status">
    <h4>Tráº¡ng thÃ¡i deploy</h4>
    <div [class]="deploymentStatus.success ? 'success' : 'error'">
      {{ deploymentStatus.message }}
    </div>
  </div>
  } @if(showTokenDialog){
  <div class="dialog - overlay">
    <div class="dialog-container">
      <div class="dialog-header">
        <h3>ğŸ”‘ Nháº­p GitHub Token</h3>
        <button (click)="closeTokenDialog()" class="btn-close">Ã—</button>
      </div>

      <div class="dialog-body">
        <form [formGroup]="tokenForm" (ngSubmit)="saveAndDeploy()">
          <div class="form-group">
            <label for="githubToken">GitHub Personal Access Token:</label>
            <input
              type="password"
              id="githubToken"
              formControlName="githubToken"
              placeholder="Nháº­p token báº¯t Ä‘áº§u báº±ng ghp_..."
              class="form-control"
            />
            @if(tokenForm.get('githubToken')?.invalid && tokenForm.get('githubToken')?.touched) {
            <div class="error-text">
              @if(tokenForm.get('githubToken')?.errors?.['required']) {
              <div>Token lÃ  báº¯t buá»™c</div>
              } @if(tokenForm.get('githubToken')?.errors?.['minlength']) {
              <div>Token pháº£i cÃ³ Ã­t nháº¥t 10 kÃ½ tá»±</div>
              }
            </div>
            }
          </div>

          <div class="token-help">
            <h5>ğŸ”§ CÃ¡ch láº¥y token:</h5>
            <ol>
              <li>
                Truy cáº­p
                <a href="https://github.com/settings/tokens" target="_blank">GitHub Tokens</a>
              </li>
              <li>Táº¡o token má»›i vá»›i quyá»n <code>public_repo</code></li>
              <li>Copy token (báº¯t Ä‘áº§u báº±ng <code>ghp_</code>)</li>
              <li>DÃ¡n token vÃ o Ã´ trÃªn</li>
            </ol>
            <p class="note">âš ï¸ Token chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng cho láº§n deploy nÃ y vÃ  khÃ´ng Ä‘Æ°á»£c lÆ°u trá»¯</p>
          </div>

          <div class="dialog-actions">
            <button
              type="button"
              (click)="closeTokenDialog()"
              class="btn btn-secondary"
              [disabled]="isSubmittingToken"
            >
              Há»§y
            </button>
            <button
              type="submit"
              class="btn btn-success"
              [disabled]="tokenForm.invalid || isSubmittingToken"
            >
              {{ isSubmittingToken ? 'ğŸ”„ Äang xá»­ lÃ½...' : 'ğŸš€ Deploy' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  }
</div>
