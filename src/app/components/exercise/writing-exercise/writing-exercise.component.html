<div class="writing-exercise">
  @for (exercise of getWritingExercises(); let i = $index; track i) {
  <div class="exercise-item">
    <div class="writing-card">
      <!-- Character Info -->
      <div class="character-info">
        <div class="main-character">{{ exercise.question }}</div>
        <div class="character-details">
          <div class="pinyin">{{ exercise.pinyin }}</div>
          <div class="meaning">{{ exercise.answer }}</div>
        </div>
      </div>

      <!-- Stroke Order Guide - Sá»­ dá»¥ng SVG thay vÃ¬ GIF -->
      <!-- <div class="stroke-guide">
        <h4>HÆ°á»›ng dáº«n thá»© tá»± viáº¿t cÃ¡c nÃ©t:</h4>
      </div> -->

      <!-- Practice Canvas -->
      <div class="practice-section">
        <div class="canvas-container">
          <canvas
            #writingCanvas
            (mousedown)="onMouseDown($event, i)"
            (mousemove)="onMouseMove($event, i)"
            (mouseup)="onMouseUp(i)"
            (mouseleave)="onMouseUp(i)"
            (touchstart)="onTouchStart($event, i)"
            (touchmove)="onTouchMove($event, i)"
            (touchend)="onTouchEnd(i)"
            class="writing-canvas"
          >
          </canvas>

          <!-- Character Template (background) -->
          <div class="character-template" aria-hidden="true">{{ exercise.question }}</div>
        </div>

        <!-- Drawing Controls -->
        <div class="drawing-controls">
          <button class="btn btn-outline" (click)="undoStroke(i)" [disabled]="!canUndo(i)">
            â†©ï¸ Undo
          </button>
          <button class="btn btn-outline" (click)="redoStroke(i)" [disabled]="!canRedo(i)">
            â†ªï¸ Redo
          </button>
          <button class="btn btn-secondary" (click)="clearCanvas(i)">ğŸ—‘ï¸ XÃ³a háº¿t</button>
        </div>
      </div>
    </div>
  </div>
  } @if(isAllCharacterCompleted()&&!isCompleted){
  <div class="text-center">
    <button class="btn btn-success" (click)="completeWriting()">ğŸ¯ Ná»™p bÃ i</button>
  </div>
  }
</div>
