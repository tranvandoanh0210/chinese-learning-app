<div class="lesson-detail">
  @if(!selectedCategory){
  <div class="lesson-hero">
    <div class="container">
      <div class="hero-content">
        <div class="lesson-badge">B√†i {{ lesson?.order }}</div>
        <h1>{{ lesson?.name_vi }}</h1>
        <h2 class="chinese-title">{{ lesson?.name_zh }}</h2>
        <p class="lesson-description">{{ lesson?.description }}</p>
        @if(lesson){
        <div class="lesson-progress-overview">
          <div class="progress-card">
            <div class="progress-header">
              <h4>üìä Ti·∫øn ƒë·ªô b√†i h·ªçc</h4>
              <span class="progress-percentage">{{ getLessonProgressPercentage() }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="getLessonProgressPercentage()"></div>
            </div>
            <div class="progress-stats">
              <div class="progress-stat">
                <span class="stat-value"
                  >{{ getCompletedCategoriesCount() }}/{{ lesson.categories.length }}</span
                >
                <span class="stat-label">Chuy√™n m·ª•c</span>
              </div>
              <div class="progress-stat">
                <span class="stat-value"
                  >{{ getCompletedExercisesCount() }}/{{ getTotalExercises() }}</span
                >
                <span class="stat-label">B√†i t·∫≠p</span>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
    </div>
  </div>
  }

  <div class="category-navigation">
    <div class="container">
      <div class="category-tabs">
        @for (category of lesson?.categories; track category.id) {
        <div
          class="category-tab"
          [class.active]="selectedCategory?.id === category.id"
          [class.completed]="isCategoryCompleted(category.id)"
          (click)="selectCategory(category)"
        >
          <div class="category-icon">
            <i [class]="getCategoryIcon(category.type)"></i>
            @if(isCategoryCompleted(category.id)){
            <div class="completion-badge">‚úì</div>
            }
          </div>
          <div class="category-info">
            <div class="category-name">{{ category.name }}</div>
            <div class="category-progress">
              <div class="progress-bar mini">
                <div
                  class="progress-fill"
                  [style.width.%]="getCategoryProgressPercentage(category.id, true)"
                ></div>
              </div>
              <span class="progress-text"
                >{{ getCategoryProgressPercentage(category.id, true) }}%</span
              >
            </div>
          </div>
          <div class="exercise-count">
            {{ category.exercises.length }} b√†i
            <!-- <span
              class="completed-count"
              *ngIf="getCategoryProgressPercentage(category.id, false) > 0"
            >
              ({{
                (getCategoryProgressPercentage(category.id, false) / 100) *
                  category.exercises.length
              }}
              ƒë√£ ho√†n th√†nh)
            </span> -->
          </div>
        </div>
        }
      </div>
    </div>
  </div>

  @if (selectedCategory) {
  <div class="category-content">
    <div class="container">
      <div class="content-header">
        <div class="header-top">
          <button class="btn-back" (click)="selectedCategory = undefined">
            ‚Üê Quay l·∫°i danh s√°ch chuy√™n m·ª•c
          </button>
          <div class="category-progress-indicator">
            <span class="progress-text"
              >Ti·∫øn ƒë·ªô: {{ getCategoryProgressPercentage(selectedCategory.id, true) }}%</span
            >
            <div class="progress-bar">
              <div
                class="progress-fill"
                [style.width.%]="getCategoryProgressPercentage(selectedCategory.id, true)"
              ></div>
            </div>
          </div>
        </div>
        <h3>{{ selectedCategory.name }}</h3>
        <p>{{ selectedCategory.description }}</p>
      </div>
      <app-exercise-display [category]="selectedCategory"> </app-exercise-display>
    </div>
  </div>
  } @if (!selectedCategory && lesson) {
  <div class="no-category-selected">
    <div class="container">
      <div class="no-category-content">
        <div class="no-category-icon">üìö</div>
        <h3>Ch·ªçn m·ªôt chuy√™n m·ª•c ƒë·ªÉ b·∫Øt ƒë·∫ßu h·ªçc</h3>
        <p>H√£y ch·ªçn m·ªôt trong c√°c chuy√™n m·ª•c ·ªü tr√™n ƒë·ªÉ xem n·ªôi dung b√†i h·ªçc</p>
        @if(getLessonProgressPercentage() > 0){
        <div class="completion-hint">
          üéâ B·∫°n ƒë√£ ho√†n th√†nh {{ getLessonProgressPercentage() }}% b√†i h·ªçc n√†y!
        </div>
        }
      </div>
    </div>
  </div>
  }
</div>
